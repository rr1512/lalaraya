import{v as O,bN as q,e as U,j as t,c as h,P as W,T as x,r as c,az as Z,c4 as Q,cX as S,bA as X,bD as A,at as Y,bp as b,a as J,f as ee,cY as te,d as v,Y as R,B as E,aC as se,A as ae,m as I,o as z,X as re,bo as M,z as ne,bz as ie,Z as oe}from"./main-9bd2e4c3.js";import{T as le,a as ce,b as me}from"./TrendingUp-f5a92bd2.js";import{A as de,F as w,a as ue,D as xe,b as fe,u as F,c as ge,d as pe,e as he}from"./admin-routes-1bae07e1.js";import{$ as je}from"./DragIndicator-c99b6a4b.js";import{I as be}from"./info-dialog-trigger-7adf8000.js";import"./blank-page-skeleton-cc50080e.js";import"./use-delete-domain-f64a66b8.js";import"./Edit-0af50b99.js";import"./use-resume-subscription-fa079469.js";import"./ChevronRight-cf01f077.js";const B="admin/reports";function ve(e={}){return O({queryKey:[B,e],queryFn:()=>we(e),placeholderData:q})}function we({types:e,dateRange:a}){const s={};return e&&(s.types=e.join(",")),a&&(s.startDate=a.start.toAbsoluteString(),s.endDate=a.end.toAbsoluteString(),s.timezone=a.start.timeZone),U.get(B,{params:s}).then(r=>r.data)}function G(e){const{title:a,description:s,children:r,className:n,contentIsFlex:i=!0,contentClassName:l,contentRef:o,minHeight:d="min-h-440"}=e;return t.jsxs("div",{className:h("rounded-panel flex h-full flex-auto flex-col border bg",d,n),children:[t.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[t.jsx("div",{className:"text-sm font-semibold",children:a}),s&&t.jsx("div",{className:"text-muted",children:s})]}),t.jsx("div",{ref:o,className:h("relative p-14",i&&"flex flex-auto items-center justify-center",l),children:r})]})}function N(){return t.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[t.jsx(W,{isIndeterminate:!0,size:"sm"}),t.jsx(x,{message:"Chart loading"})]})}const Ne=c.lazy(()=>Z(()=>import("./lazy-chart-3f6b5ac4.js"),["./lazy-chart-3f6b5ac4.js","./main-9bd2e4c3.js","./main-48eddb53.css"],import.meta.url));function y(e){const{title:a,description:s,className:r,contentRef:n,isLoading:i}=e;return t.jsx(G,{title:a,description:s,className:r,contentRef:n,children:t.jsxs(c.Suspense,{fallback:t.jsx(N,{}),children:[t.jsx(Ne,{...e}),i&&t.jsx(N,{})]})})}function D(e,{localeCode:a="en",shareFirstDatasetLabels:s=!0}){if(!e)return{datasets:[]};const r=[];return{...e,datasets:e.datasets.map((n,i)=>{const l=n.data.map((o,d)=>{let m;return i===0||!s?(m=ye(o,e.granularity,a),r[d]=m):m=r[d],{...m,value:o.value}});return{...n,data:l}})}}function ye(e,a,s){return e.label?{label:e.label}:e.date?De(e,a,s):{label:""}}function De({date:e,endDate:a},s="day",r){const n=A(e).toDate(),i=a?A(a).toDate():null;switch(s){case"minute":return{label:u(r,{second:"2-digit"}).format(n),tooltipTitle:u(r,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(n)};case"hour":return{label:u(r,{hour:"numeric",minute:"numeric"}).format(n),tooltipTitle:u(r,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(n)};case"day":return{label:u(r,{day:"2-digit",weekday:"short"}).format(n),tooltipTitle:u(r,{day:"2-digit",weekday:"short",month:"short"}).format(n)};case"week":return{label:u(r,{month:"short",day:"2-digit"}).format(n),tooltipTitle:u(r,{day:"2-digit",month:"long",year:"numeric"}).formatRange(n,i)};case"month":return{label:u(r,{month:"short",year:"numeric"}).format(n),tooltipTitle:u(r,{month:"long",year:"numeric"}).format(n)};case"year":return{label:u(r,{year:"numeric"}).format(n),tooltipTitle:u(r,{year:"numeric"}).format(n)}}}const u=Q((e,a)=>new S(e,a),{equals:(e,a)=>X(e,a),callTimeout:void 0}),P=Y().themes.all[0].values["--be-primary"],f=[[`rgb(${P.replaceAll(" ",",")})`,`rgba(${P.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],Ce={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function Te({data:e,className:a,...s}){const{localeCode:r}=b(),n=c.useMemo(()=>{const i=D(e,{localeCode:r});return i.datasets=i.datasets.map((l,o)=>({...l,backgroundColor:f[o][1],borderColor:f[o][0],pointBackgroundColor:f[o][0]})),i},[e,r]);return t.jsx(y,{...s,className:h(a,"min-w-500"),data:n,type:"line",options:Ce})}const ke={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Ae({data:e,className:a,...s}){const{localeCode:r}=b(),n=c.useMemo(()=>{var l;const i=D(e,{localeCode:r});return i.labels=(l=i.datasets[0])==null?void 0:l.data.map(o=>o.label),i.datasets=i.datasets.map((o,d)=>({...o,backgroundColor:f.map(m=>m[1]),borderColor:f.map(m=>m[0]),borderWidth:2})),i},[e,r]);return t.jsx(y,{type:"polarArea",data:n,options:ke,className:h(a,"min-w-500"),...s})}function Re({data:e,direction:a="vertical",individualBarColors:s=!1,className:r,...n}){const{localeCode:i}=b(),l=c.useMemo(()=>{const m=D(e,{localeCode:i});return m.datasets=m.datasets.map((p,j)=>({...p,backgroundColor:s?f.map(g=>g[1]):f[j][1],borderColor:s?f.map(g=>g[0]):f[j][0],borderWidth:2})),m},[e,i,s]),o=a==="horizontal",d=c.useMemo(()=>({indexAxis:o?"y":"x",parsing:{xAxisKey:o?"value":"label",yAxisKey:o?"label":"value"}}),[o]);return t.jsx(y,{type:"bar",className:h(r,"min-w-500"),data:l,options:d,...n})}function $(e){try{return je(`rgb(${e.split(" ").join(",")})`).toString("hex")}catch{return e}}const V="https://www.gstatic.com/charts/loader.js";function Ie({placeholderRef:e,data:a,country:s,onCountrySelected:r}){const{trans:n}=J(),{analytics:i}=ee(),l=i==null?void 0:i.gchart_api_key,{selectedTheme:o}=te(),d=c.useRef(),m=!!r&&!s,p=c.useCallback(()=>{var C,T;if(typeof google>"u")return;const g=a.map(k=>[k.label,k.value]);g.unshift([n(s?v("City"):v("Country")),n(v("Clicks"))]);const K=`${$(o.values["--be-paper"])}`,H={colorAxis:{colors:[`${$(o.values["--be-primary"])}`]},backgroundColor:K,region:s?s.toUpperCase():void 0,resolution:s?"provinces":"countries",displayMode:s?"markers":"regions",enableRegionInteractivity:m};!d.current&&e.current&&((C=google==null?void 0:google.visualization)!=null&&C.GeoChart)&&(d.current=new google.visualization.GeoChart(e.current)),(T=d.current)==null||T.draw(google.visualization.arrayToDataTable(g),H)},[o,a,e,n,s,m]),j=c.useCallback(async()=>{R.isLoadingOrLoaded(V)||(await R.loadAsset(V,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:l}),p())},[l,p]);return c.useEffect(()=>(d.current&&r&&google.visualization.events.addListener(d.current,"regionClick",g=>r==null?void 0:r(g.region)),()=>{d.current&&google.visualization.events.removeAllListeners(d.current)}),[r,d.current]),c.useEffect(()=>{j()},[j]),c.useEffect(()=>{p()},[o,p,a]),{drawGoogleChart:p}}const ze=c.memo(({code:e})=>{const{localeCode:a}=b(),s=new Intl.DisplayNames([a],{type:"region"});let r;try{r=s.of(e.toUpperCase())}catch{}return t.jsx(c.Fragment,{children:r})});function Fe({data:e,isLoading:a,onCountrySelected:s,country:r,...n}){const i=c.useRef(null),l=!!s,o=e==null?void 0:e.datasets[0].data,d=c.useMemo(()=>o||[],[o]);return Ie({placeholderRef:i,data:d,country:r,onCountrySelected:s}),t.jsxs(G,{...n,className:"min-w-500",title:t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{message:"Top Locations"}),r?t.jsxs("span",{className:"pl-4",children:["(",t.jsx(ze,{code:r}),")"]}):null,l&&t.jsx(Pe,{})]}),contentIsFlex:a,children:[a&&t.jsx(N,{}),t.jsxs("div",{className:"flex gap-24",children:[t.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),t.jsxs("div",{className:"w-[170px]",children:[t.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:d.map(m=>t.jsxs("div",{className:h("flex items-center gap-4 mb-4",l&&"cursor-pointer hover:underline"),role:l?"button":void 0,onClick:()=>{s==null||s(m.code)},children:[t.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:m.label}),t.jsxs("div",{children:["(",m.percentage,")%"]})]},m.label))}),r&&t.jsx(E,{variant:"outline",size:"xs",className:"mt-14",startIcon:t.jsx(de,{}),onClick:()=>{s==null||s(void 0)},children:t.jsx(x,{message:"Back to countries"})})]})]})]})}function Pe(){return t.jsx(be,{title:t.jsx(x,{message:"Zooming in"}),body:t.jsx(x,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const _="gap-12 md:gap-24 mb-12 md:mb-24",L=`flex flex-col md:flex-row md:items-center overflow-x-auto ${_}`;function $e({report:e,isLoading:a}){const s=e==null?void 0:e.pageViews.total;return t.jsxs(c.Fragment,{children:[t.jsxs("div",{className:L,children:[t.jsx(Te,{isLoading:a,className:"flex-auto",data:e==null?void 0:e.pageViews,title:t.jsx(x,{message:"Pageviews"}),description:s?t.jsx(x,{message:":count total views",values:{count:t.jsx(w,{value:s})}}):null}),t.jsx(Ae,{isLoading:a,data:e==null?void 0:e.devices,title:t.jsx(x,{message:"Top devices"})})]}),t.jsxs("div",{className:L,children:[t.jsx(Re,{isLoading:a,data:e==null?void 0:e.browsers,className:"flex-auto md:w-1/3",direction:"horizontal",individualBarColors:!0,hideLegend:!0,title:t.jsx(x,{message:"Top browsers"})}),t.jsx(Fe,{isLoading:a,className:"flex-auto",data:e==null?void 0:e.locations,title:t.jsx(x,{message:"Top locations"})})]})]})}function Ve({report:e,isLoading:a}){return t.jsx("div",{className:`flex h-[97px] flex-shrink-0 items-center overflow-x-auto ${_}`,children:e==null?void 0:e.map(s=>t.jsx(Le,{datum:s,isLoading:a},s.name))})}function Le({datum:e,isLoading:a=!1}){let s;if(c.isValidElement(e.icon))s=c.cloneElement(e.icon,{size:"lg"});else{const r=se(e.icon);s=t.jsx(r,{size:"lg"})}return t.jsxs("div",{className:"rounded-panel flex h-full flex-auto items-center gap-18 whitespace-nowrap border p-20",children:[t.jsx("div",{className:"flex-shrink-0 rounded-lg bg-primary-light/20 p-10 text-primary",children:s}),t.jsxs("div",{className:"flex-auto",children:[t.jsx("div",{className:"flex items-center justify-between gap-20",children:t.jsx("div",{className:"text-lg font-bold text-main",children:t.jsx(ae,{initial:!1,mode:"wait",children:a?t.jsx(I.div,{...z,children:t.jsx(re,{className:"min-w-24"})},"skeleton"):t.jsx(I.div,{...z,children:t.jsx(Ee,{datum:e})},"value")})})}),t.jsxs("div",{className:"flex items-center justify-between gap-20",children:[t.jsx("h2",{className:"text-sm text-muted",children:e.name}),(e.percentageChange!=null||e.previousValue!=null)&&t.jsx("div",{className:"flex items-center gap-10",children:t.jsx(Me,{datum:e})})]})]})]},e.name)}function Ee({datum:e}){switch(e.type){case"fileSize":return t.jsx(ue,{bytes:e.currentValue});case"percentage":return t.jsx(w,{value:e.currentValue,style:"percent",maximumFractionDigits:1});default:return t.jsx(w,{value:e.currentValue})}}function Me({datum:e}){const a=Be(e);let s;return a>0?s=t.jsx(le,{size:"md",className:"text-positive"}):a===0?s=t.jsx(ce,{className:"text-muted"}):s=t.jsx(me,{className:"text-danger"}),t.jsxs(c.Fragment,{children:[s,t.jsxs("div",{className:"text-sm font-semibold text-muted",children:[a,"%"]})]})}function Be({percentageChange:e,previousValue:a,currentValue:s}){return e!=null||a==null||s==null?e??0:a===0?100:Math.round((s-a)/a*100)}const Ge={month:"short",day:"2-digit"};function _e({value:e,onChange:a,disabled:s,compactOnMobile:r=!0,enableCompare:n=!1,granularity:i="minute"}){const l=M();return t.jsxs(ne,{type:"popover",onClose:o=>{o&&a(o)},children:[t.jsx(E,{variant:"outline",color:"chip",endIcon:t.jsx(xe,{}),disabled:s,children:t.jsx(fe,{start:e.start,end:e.end,options:l&&r?Ge:ie.short})}),t.jsx(Ke,{value:e,enableCompare:n,granularity:i})]})}function Ke({value:e,enableCompare:a,granularity:s}){const r=M(),n=F({granularity:s,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,l=F({granularity:s,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:ge[0].getRangeValue(n.selectedValue)});return t.jsx(pe,{state:n,compareState:a?l:void 0,compareVisibleDefault:i,showInlineDatePickerField:!r})}function et(){const[e,a]=c.useState(()=>he[2].getRangeValue()),{isLoading:s,data:r}=ve({dateRange:e}),n=t.jsx(x,{message:"Visitors report"});return t.jsxs("div",{className:"min-h-full gap-12 overflow-x-hidden p-12 md:gap-24 md:p-24",children:[t.jsxs("div",{className:"mb-24 items-center justify-between gap-24 md:flex",children:[t.jsx(oe,{children:n}),t.jsx("h1",{className:"mb-24 text-3xl font-light md:mb-0",children:n}),t.jsx(_e,{value:e,onChange:a})]}),t.jsx(Ve,{report:r==null?void 0:r.headerReport}),t.jsx($e,{report:r==null?void 0:r.visitorsReport,isLoading:s})]})}export{et as default};
//# sourceMappingURL=admin-report-page-9e57c59c.js.map
